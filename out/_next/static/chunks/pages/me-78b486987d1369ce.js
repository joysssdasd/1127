(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[865],{7237:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/me",function(){return n(3274)}])},2021:function(e,s,n){"use strict";n.d(s,{Z:function(){return d}});var a=n(5893),i=n(1664),t=n.n(i),r=n(1163),l=n(4611);let c=[{href:"/",label:"首页"},{href:"/publish",label:"发布"},{href:"/search",label:"智能搜索"},{href:"/recharge",label:"积分充值"},{href:"/me",label:"个人中心"}];function d(e){var s,n,i;let{children:d}=e,h=(0,r.useRouter)(),{user:o,logout:u}=(0,l.a)(),m=e=>"/"===e?"/"===h.pathname:h.pathname===e||h.pathname.startsWith("".concat(e,"/"));return(0,a.jsxs)("div",{style:{padding:"0 20px"},children:[(0,a.jsxs)("header",{className:"app-header",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"app-brand",children:"C2C 情报局"}),(0,a.jsx)("div",{style:{fontSize:12,color:"var(--muted)"},children:"72 小时自动下架 \xb7 智能风控撮合 \xb7 Supabase 实时底座"})]}),(0,a.jsx)("nav",{className:"app-nav",children:c.map(e=>(0,a.jsx)(t(),{href:e.href,className:m(e.href)?"active":void 0,children:e.label},e.href))}),(0,a.jsx)("div",{className:"user-chip",children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontWeight:600},children:null!==(s=o.phone)&&void 0!==s?s:"未绑定手机"}),(0,a.jsxs)("div",{style:{fontSize:12,color:"var(--muted)"},children:["微信：",null!==(n=o.wechat)&&void 0!==n?n:"未设置"," \xb7 积分 ",null!==(i=o.points)&&void 0!==i?i:0]})]}),(0,a.jsx)("button",{className:"secondary-btn",onClick:u,children:"退出"})]}):(0,a.jsx)(t(),{className:"primary-btn",href:"/auth/login",children:"登录 / 入驻"})})]}),(0,a.jsx)("main",{style:{maxWidth:1200,margin:"0 auto 60px",padding:"0 8px"},children:d})]})}},971:function(e,s,n){"use strict";n.d(s,{F:function(){return i}});var a=n(5893);function i(e){let{message:s}=e;return s?(0,a.jsx)("div",{className:"toast",children:s}):null}},7996:function(e,s,n){"use strict";n.d(s,{p:function(){return i}});var a=n(7294);function i(){let[e,s]=(0,a.useState)(null);return{message:e,show:(0,a.useCallback)(e=>{s(e),window.setTimeout(()=>s(null),2500)},[])}}},3274:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return o}});var a=n(5893),i=n(1664),t=n.n(i),r=n(7294),l=n(2021),c=n(4611),d=n(971),h=n(7996);function o(){var e;let{tokens:s,user:n,logout:i,refreshProfile:o}=(0,c.a)(),{message:u,show:m}=(0,h.p)(),[j,x]=(0,r.useState)(0),[p,v]=(0,r.useState)([]),[f,g]=(0,r.useState)([]),[N,b]=(0,r.useState)([]),[y,w]=(0,r.useState)(""),[S,k]=(0,r.useState)(""),[T,C]=(0,r.useState)(!1);(0,r.useEffect)(()=>{var e;w(null!==(e=null==n?void 0:n.wechat)&&void 0!==e?e:"")},[null==n?void 0:n.wechat]),(0,r.useEffect)(()=>{s&&(fetch("/api/points/balance",{headers:{Authorization:"Bearer ".concat(s.accessToken)}}).then(e=>e.json()).then(e=>{var s;return x(null!==(s=e.balance)&&void 0!==s?s:0)}).catch(()=>m("无法获取积分余额")),fetch("/api/points/history",{headers:{Authorization:"Bearer ".concat(s.accessToken)}}).then(e=>e.json()).then(e=>{var s;return v(null!==(s=e.data)&&void 0!==s?s:[])}),fetch("/api/users/listings",{headers:{Authorization:"Bearer ".concat(s.accessToken)}}).then(e=>e.json()).then(e=>{var s;return g(null!==(s=e.data)&&void 0!==s?s:[])}),fetch("/api/users/purchases",{headers:{Authorization:"Bearer ".concat(s.accessToken)}}).then(e=>e.json()).then(e=>{var s;return b(null!==(s=e.data)&&void 0!==s?s:[])}))},[s]);let _=async()=>{if(!s){m("请先登录");return}if(!y.trim()&&!S.trim()){m("请填写至少一项信息");return}C(!0);try{let n=await fetch("/api/users/me",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s.accessToken)},body:JSON.stringify({wechat:y.trim(),password:S.trim()||void 0})}),a=await n.json();if(!n.ok){var e;throw Error(null!==(e=a.error)&&void 0!==e?e:"更新失败")}m("资料已更新"),k(""),await o()}catch(e){m(e.message)}finally{C(!1)}};return s?(0,a.jsxs)(l.Z,{children:[(0,a.jsxs)("div",{className:"page-section",children:[(0,a.jsx)("div",{className:"section-heading",children:"我的仪表盘"}),(0,a.jsx)("p",{className:"section-subtitle",children:"查看积分、成交情况与快速操作入口。"}),(0,a.jsxs)("div",{className:"grid-three",children:[(0,a.jsxs)("div",{className:"feature-card",children:[(0,a.jsx)("h3",{style:{marginTop:0},children:"积分余额"}),(0,a.jsx)("p",{style:{fontSize:32,margin:0},children:j})]}),(0,a.jsxs)("div",{className:"feature-card",children:[(0,a.jsx)("h3",{style:{marginTop:0},children:"累计成交"}),(0,a.jsx)("p",{style:{fontSize:32,margin:0},children:null!==(e=null==n?void 0:n.totalDeals)&&void 0!==e?e:0})]}),(0,a.jsxs)("div",{className:"feature-card",children:[(0,a.jsx)("h3",{style:{marginTop:0},children:"在架信息"}),(0,a.jsx)("p",{style:{fontSize:32,margin:0},children:f.length})]})]}),(0,a.jsxs)("div",{className:"cta-stack",children:[(0,a.jsx)(t(),{className:"primary-btn",href:"/publish",children:"发布信息"}),(0,a.jsx)(t(),{className:"secondary-btn",href:"/recharge",children:"充值积分"}),(0,a.jsx)("button",{className:"secondary-btn",onClick:i,children:"退出登录"})]})]}),(0,a.jsxs)("div",{className:"page-section",children:[(0,a.jsx)("div",{className:"section-heading",children:"联系方式与安全"}),(0,a.jsxs)("div",{className:"form-grid",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"微信号"}),(0,a.jsx)("input",{value:y,onChange:e=>w(e.target.value),placeholder:"用于展示给买家"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"新密码"}),(0,a.jsx)("input",{type:"password",value:S,onChange:e=>k(e.target.value),placeholder:"留空则不修改"})]}),(0,a.jsx)("button",{className:"primary-btn",onClick:_,disabled:T,children:T?"保存中...":"保存信息"})]})]}),(0,a.jsxs)("div",{className:"page-section",children:[(0,a.jsx)("div",{className:"section-heading",children:"我的发布"}),0===f.length&&(0,a.jsx)("p",{style:{color:"var(--muted)"},children:"暂无发布记录，前往发布页开始撮合。"}),(0,a.jsx)("div",{className:"listing-grid",children:f.map(e=>(0,a.jsxs)("div",{className:"list-card",children:[(0,a.jsx)("h3",{children:e.title}),(0,a.jsx)("p",{style:{color:"var(--muted)"},children:e.description}),(0,a.jsxs)("div",{className:"meta-row",children:[(0,a.jsxs)("span",{className:"badge",children:["价格 \xa5",e.price]}),(0,a.jsxs)("span",{className:"badge",children:["剩余 ",e.remainingViews,"/",e.viewLimit]})]})]},e.id))})]}),(0,a.jsxs)("div",{className:"page-section",children:[(0,a.jsx)("div",{className:"section-heading",children:"我的足迹"}),0===N.length&&(0,a.jsx)("p",{style:{color:"var(--muted)"},children:"还没有解锁过任何线索。"}),(0,a.jsx)("div",{className:"timeline",children:N.slice(0,6).map(e=>(0,a.jsxs)("div",{className:"timeline-item",children:[(0,a.jsx)("div",{className:"timeline-dot"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("strong",{children:["信息 ",e.postId]}),(0,a.jsxs)("p",{className:"form-note",children:["状态：","pending"===e.confirmStatus?"待确认":"已确认"," \xb7 截止 ",new Date(e.confirmDeadline).toLocaleString()]})]})]},e.id))})]}),(0,a.jsxs)("div",{className:"page-section",children:[(0,a.jsx)("div",{className:"section-heading",children:"积分流水"}),0===p.length&&(0,a.jsx)("p",{style:{color:"var(--muted)"},children:"暂无流水。"}),p.length>0&&(0,a.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{style:{textAlign:"left",color:"var(--muted)"},children:[(0,a.jsx)("th",{children:"时间"}),(0,a.jsx)("th",{children:"类型"}),(0,a.jsx)("th",{children:"变动"}),(0,a.jsx)("th",{children:"说明"})]})}),(0,a.jsx)("tbody",{children:p.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:new Date(e.createdAt).toLocaleString()}),(0,a.jsx)("td",{children:e.changeType}),(0,a.jsx)("td",{style:{color:e.amount>0?"#16a34a":"#dc2626"},children:e.amount}),(0,a.jsx)("td",{children:e.description})]},e.id))})]})]}),(0,a.jsx)(d.F,{message:u})]}):(0,a.jsx)(l.Z,{children:(0,a.jsx)("div",{className:"page-section",children:(0,a.jsx)("p",{children:"请先登录后查看个人中心。"})})})}}},function(e){e.O(0,[424,888,774,179],function(){return e(e.s=7237)}),_N_E=e.O()}]);
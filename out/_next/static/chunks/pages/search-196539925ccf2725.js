(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[603],{8266:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/search",function(){return a(337)}])},2021:function(e,s,a){"use strict";a.d(s,{Z:function(){return d}});var n=a(5893),t=a(1664),i=a.n(t),c=a(1163),l=a(4611);let r=[{href:"/",label:"首页"},{href:"/publish",label:"发布"},{href:"/search",label:"智能搜索"},{href:"/recharge",label:"积分充值"},{href:"/me",label:"个人中心"}];function d(e){var s,a,t;let{children:d}=e,o=(0,c.useRouter)(),{user:h,logout:u}=(0,l.a)(),m=e=>"/"===e?"/"===o.pathname:o.pathname===e||o.pathname.startsWith("".concat(e,"/"));return(0,n.jsxs)("div",{style:{padding:"0 20px"},children:[(0,n.jsxs)("header",{className:"app-header",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"app-brand",children:"C2C 情报局"}),(0,n.jsx)("div",{style:{fontSize:12,color:"var(--muted)"},children:"72 小时自动下架 \xb7 智能风控撮合 \xb7 Supabase 实时底座"})]}),(0,n.jsx)("nav",{className:"app-nav",children:r.map(e=>(0,n.jsx)(i(),{href:e.href,className:m(e.href)?"active":void 0,children:e.label},e.href))}),(0,n.jsx)("div",{className:"user-chip",children:h?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontWeight:600},children:null!==(s=h.phone)&&void 0!==s?s:"未绑定手机"}),(0,n.jsxs)("div",{style:{fontSize:12,color:"var(--muted)"},children:["微信：",null!==(a=h.wechat)&&void 0!==a?a:"未设置"," \xb7 积分 ",null!==(t=h.points)&&void 0!==t?t:0]})]}),(0,n.jsx)("button",{className:"secondary-btn",onClick:u,children:"退出"})]}):(0,n.jsx)(i(),{className:"primary-btn",href:"/auth/login",children:"登录 / 入驻"})})]}),(0,n.jsx)("main",{style:{maxWidth:1200,margin:"0 auto 60px",padding:"0 8px"},children:d})]})}},971:function(e,s,a){"use strict";a.d(s,{F:function(){return t}});var n=a(5893);function t(e){let{message:s}=e;return s?(0,n.jsx)("div",{className:"toast",children:s}):null}},7996:function(e,s,a){"use strict";a.d(s,{p:function(){return t}});var n=a(7294);function t(){let[e,s]=(0,n.useState)(null);return{message:e,show:(0,n.useCallback)(e=>{s(e),window.setTimeout(()=>s(null),2500)},[])}}},337:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return o}});var n=a(5893),t=a(7294),i=a(2021),c=a(4611),l=a(7996),r=a(971);let d=["教育","企业服务","供应链","快消","房源"];function o(){let{tokens:e}=(0,c.a)(),{message:s,show:a}=(0,l.p)(),[o,h]=(0,t.useState)(""),[u,m]=(0,t.useState)([]),[v,p]=(0,t.useState)([]),[x,j]=(0,t.useState)([]),[f,N]=(0,t.useState)(!1),g=async()=>{var s;if(!e)return;let a=await fetch("/api/search/history",{headers:{Authorization:"Bearer ".concat(e.accessToken)}});p(null!==(s=(await a.json()).data)&&void 0!==s?s:[])};(0,t.useEffect)(()=>{g()},[e]),(0,t.useEffect)(()=>{if(!o.trim()){j([]);return}let s=window.setTimeout(async()=>{var s,a;let n=e?{Authorization:"Bearer ".concat(e.accessToken)}:void 0,t=await fetch("/api/search/suggestions?prefix=".concat(encodeURIComponent(o.trim())),n?{headers:n}:void 0);j(null!==(a=null===(s=(await t.json()).data)||void 0===s?void 0:s.suggestions)&&void 0!==a?a:[])},250);return()=>window.clearTimeout(s)},[o,e]);let y=async s=>{let n=null!=s?s:o;if(n.trim()){N(!0);try{var t;let s=e?{Authorization:"Bearer ".concat(e.accessToken)}:void 0,a=await fetch("/api/search?keyword=".concat(encodeURIComponent(n.trim())),s?{headers:s}:void 0),i=await a.json();m(null!==(t=i.data)&&void 0!==t?t:[]),g()}catch(e){a(e.message)}finally{N(!1)}}},b=async()=>{e&&(await fetch("/api/search/history",{method:"DELETE",headers:{Authorization:"Bearer ".concat(e.accessToken)}}),p([]))};return(0,n.jsxs)(i.Z,{children:[(0,n.jsxs)("div",{className:"page-section",children:[(0,n.jsx)("div",{className:"section-heading",children:"智能搜索"}),(0,n.jsx)("p",{className:"section-subtitle",children:"历史记录、AI 联想与人工推荐相结合，适合在移动端下拉刷新使用。"}),(0,n.jsxs)("div",{className:"input-row",style:{marginBottom:16},children:[(0,n.jsx)("input",{value:o,onChange:e=>h(e.target.value),placeholder:"输入关键词、品牌或城市",style:{flex:1}}),(0,n.jsx)("button",{className:"primary-btn",onClick:()=>y(),disabled:f,children:f?"检索中...":"搜索"})]}),x.length>0&&(0,n.jsxs)("div",{style:{marginBottom:16},children:[(0,n.jsx)("div",{className:"form-note",children:"智能联想"}),(0,n.jsx)("div",{className:"list-card-actions",children:x.map(e=>(0,n.jsx)("button",{className:"secondary-btn",onClick:()=>y(e),children:e},e))})]}),(0,n.jsx)("div",{className:"form-note",children:"热门筛选"}),(0,n.jsx)("div",{className:"list-card-actions",children:d.map(e=>(0,n.jsx)("button",{className:"secondary-btn",onClick:()=>y(e),children:e},e))})]}),v.length>0&&(0,n.jsxs)("div",{className:"page-section",children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)("div",{className:"section-heading",style:{marginBottom:0},children:"历史记录"}),(0,n.jsx)("button",{className:"secondary-btn",onClick:b,children:"清空"})]}),(0,n.jsx)("div",{className:"list-card-actions",style:{marginTop:16},children:v.map(e=>(0,n.jsx)("button",{className:"secondary-btn",onClick:()=>y(e),children:e},e))})]}),(0,n.jsxs)("div",{className:"page-section",children:[(0,n.jsx)("div",{className:"section-heading",children:"搜索结果"}),0===u.length&&!f&&(0,n.jsx)("p",{style:{color:"var(--muted)"},children:"暂无结果，换个维度试试。"}),(0,n.jsx)("div",{className:"listing-grid",children:u.map(e=>{var s;return(0,n.jsxs)("div",{className:"list-card",children:[(0,n.jsxs)("div",{className:"meta-row",children:[(0,n.jsxs)("span",{className:"chip",children:["成交 ",null!==(s=e.totalDeals)&&void 0!==s?s:0," 次"]}),(0,n.jsxs)("span",{className:"chip emphasis",children:["剩余 ",e.remainingViews," 次"]})]}),(0,n.jsx)("h3",{children:e.title}),(0,n.jsx)("div",{className:"meta-row",children:(0,n.jsxs)("span",{className:"badge",children:[(0,n.jsx)("strong",{children:"价格"})," \xa5",e.price]})})]},e.id)})})]}),(0,n.jsx)(r.F,{message:s})]})}}},function(e){e.O(0,[424,888,774,179],function(){return e(e.s=8266)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{6840:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return t(9645)}])},4611:function(e,n,t){"use strict";t.d(n,{H:function(){return l},a:function(){return a}});var r=t(5893),o=t(7294);let u=(0,o.createContext)({user:null,tokens:null,loading:!1,isAdmin:!1,login:()=>{},logout:()=>{},refreshProfile:async()=>{}}),i="c2c-auth";async function s(e){let n=await fetch("/api/users/me",{headers:{Authorization:"Bearer ".concat(e)}});if(!n.ok)throw Error("获取用户信息失败");let t=await n.json();return{user:t.user,isAdmin:!!t.isAdmin}}function l(e){let{children:n}=e,[t,l]=(0,o.useState)(null),[a,c]=(0,o.useState)(null),[f,d]=(0,o.useState)(!1),[w,m]=(0,o.useState)(!0);(0,o.useEffect)(()=>{let e=window.localStorage.getItem(i);if(e){let n=JSON.parse(e);c(n);let t=new Promise((e,n)=>{setTimeout(()=>n(Error("请求超时")),5e3)});Promise.race([s(n.accessToken),t]).then(e=>{l(e.user),d(e.isAdmin)}).catch(e=>{console.warn("获取用户信息失败:",e),window.localStorage.removeItem(i),c(null),d(!1)}).finally(()=>m(!1))}else m(!1)},[]);let h=async()=>{if(!a)return;let e=await s(a.accessToken);l(e.user),d(e.isAdmin)};return(0,r.jsx)(u.Provider,{value:{user:t,tokens:a,loading:w,isAdmin:f,login:e=>{let{user:n,tokens:t,isAdmin:r}=e;c(t),l(n),d(r),window.localStorage.setItem(i,JSON.stringify(t))},logout:()=>{c(null),l(null),d(!1),window.localStorage.removeItem(i)},refreshProfile:h},children:n})}function a(){return(0,o.useContext)(u)}},9645:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return u}});var r=t(5893);t(3434);var o=t(4611);function u(e){let{Component:n,pageProps:t}=e;return(0,r.jsx)(o.H,{children:(0,r.jsx)(n,{...t})})}},3434:function(){}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[774,179],function(){return n(6840),n(3079)}),_N_E=e.O()}]);
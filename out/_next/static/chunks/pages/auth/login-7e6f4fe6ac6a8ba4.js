(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[344],{163:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth/login",function(){return a(9042)}])},2021:function(e,s,a){"use strict";a.d(s,{Z:function(){return d}});var n=a(5893),t=a(1664),i=a.n(t),r=a(1163),l=a(4611);let c=[{href:"/",label:"首页"},{href:"/publish",label:"发布"},{href:"/search",label:"智能搜索"},{href:"/recharge",label:"积分充值"},{href:"/me",label:"个人中心"}];function d(e){var s,a,t;let{children:d}=e,o=(0,r.useRouter)(),{user:h,logout:u}=(0,l.a)(),m=e=>"/"===e?"/"===o.pathname:o.pathname===e||o.pathname.startsWith("".concat(e,"/"));return(0,n.jsxs)("div",{style:{padding:"0 20px"},children:[(0,n.jsxs)("header",{className:"app-header",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"app-brand",children:"C2C 情报局"}),(0,n.jsx)("div",{style:{fontSize:12,color:"var(--muted)"},children:"72 小时自动下架 \xb7 智能风控撮合 \xb7 Supabase 实时底座"})]}),(0,n.jsx)("nav",{className:"app-nav",children:c.map(e=>(0,n.jsx)(i(),{href:e.href,className:m(e.href)?"active":void 0,children:e.label},e.href))}),(0,n.jsx)("div",{className:"user-chip",children:h?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontWeight:600},children:null!==(s=h.phone)&&void 0!==s?s:"未绑定手机"}),(0,n.jsxs)("div",{style:{fontSize:12,color:"var(--muted)"},children:["微信：",null!==(a=h.wechat)&&void 0!==a?a:"未设置"," \xb7 积分 ",null!==(t=h.points)&&void 0!==t?t:0]})]}),(0,n.jsx)("button",{className:"secondary-btn",onClick:u,children:"退出"})]}):(0,n.jsx)(i(),{className:"primary-btn",href:"/auth/login",children:"登录 / 入驻"})})]}),(0,n.jsx)("main",{style:{maxWidth:1200,margin:"0 auto 60px",padding:"0 8px"},children:d})]})}},971:function(e,s,a){"use strict";a.d(s,{F:function(){return t}});var n=a(5893);function t(e){let{message:s}=e;return s?(0,n.jsx)("div",{className:"toast",children:s}):null}},7996:function(e,s,a){"use strict";a.d(s,{p:function(){return t}});var n=a(7294);function t(){let[e,s]=(0,n.useState)(null);return{message:e,show:(0,n.useCallback)(e=>{s(e),window.setTimeout(()=>s(null),2500)},[])}}},9042:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return h}});var n=a(5893),t=a(7294),i=a(1163),r=a(2021),l=a(4611),c=a(7996),d=a(971);let o=[{key:"password",label:"密码登录"},{key:"sms",label:"短信 + 密码"}];function h(){let e=(0,i.useRouter)(),{login:s,tokens:a}=(0,l.a)(),{message:h,show:u}=(0,c.p)(),[m,p]=(0,t.useState)("password"),[x,j]=(0,t.useState)(""),[f,v]=(0,t.useState)(""),[b,y]=(0,t.useState)(""),[g,N]=(0,t.useState)(""),[w,k]=(0,t.useState)(!1),[S,C]=(0,t.useState)(0),[_,T]=(0,t.useState)(!1),E=async()=>{if(!x.trim()){u("请输入手机号");return}if(!b.trim()){u("请输入微信号以便成交后展示给买家");return}k(!0);try{let s=await fetch("/api/auth/send-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:x})}),a=await s.json();if(!s.ok){var e;throw Error(null!==(e=a.error)&&void 0!==e?e:"验证码发送失败")}u("验证码已发送"),C(60);let n=window.setInterval(()=>{C(e=>e<=1?(clearInterval(n),0):e-1)},1e3)}catch(e){u(e.message)}finally{k(!1)}},O=async()=>{if(!x.trim()){u("请输入手机号");return}if(!f.trim()){u("请输入密码");return}if("sms"===m){if(!g.trim()){u("请输入短信验证码");return}if(!b.trim()){u("请输入微信号");return}}T(!0);try{let n={phone:x.trim(),password:f};b.trim()&&(n.wechat=b.trim()),"sms"===m&&(n.code=g.trim());let t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),i=await t.json();if(!t.ok){var a;throw Error(null!==(a=i.error)&&void 0!==a?a:"登录失败")}s({user:i.user,tokens:i.tokens,isAdmin:i.isAdmin}),u("登录成功"),i.isAdmin?e.replace("/admin"):e.replace("/")}catch(e){u(e.message)}finally{T(!1)}};return(0,n.jsxs)(r.Z,{children:[(0,n.jsx)("div",{className:"page-section",children:(0,n.jsxs)("div",{className:"auth-grid",children:[(0,n.jsxs)("div",{className:"auth-hero",children:[(0,n.jsx)("div",{className:"chip emphasis",children:"统一入口"}),(0,n.jsx)("h1",{style:{marginTop:12,marginBottom:8},children:"短信 + 密码双通道"}),(0,n.jsx)("p",{style:{maxWidth:360,opacity:.9},children:"默认使用密码保持高频登录，首次入驻或管理员账号需切换短信模式完成一次实名校验。"}),(0,n.jsxs)("ul",{style:{marginTop:24,lineHeight:1.8},children:[(0,n.jsx)("li",{children:"管理员（13011319329 / 13001220766）仅支持短信方式进入后台"}),(0,n.jsx)("li",{children:"短信通道由 SPUG 提供，支持 targets 动态指定推送对象"}),(0,n.jsx)("li",{children:"完成首次登录即自动绑定微信联系方式，撮合时直接透出"})]})]}),(0,n.jsxs)("div",{className:"auth-card",children:[(0,n.jsx)("h2",{style:{marginTop:0},children:"进入情报局"}),(0,n.jsx)("p",{className:"form-note",children:"管理员默认跳转后台；普通用户可在此完成注册、登录与微信绑定。"}),(0,n.jsx)("div",{className:"tab-switch",children:o.map(e=>(0,n.jsx)("button",{className:m===e.key?"active":void 0,onClick:()=>p(e.key),children:e.label},e.key))}),"sms"===m&&(0,n.jsx)("p",{className:"form-note",children:"短信模式会自动注册账户并同步微信号，适合首次入驻或忘记密码。"}),(0,n.jsxs)("div",{className:"form-grid",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"手机号"}),(0,n.jsx)("input",{value:x,onChange:e=>j(e.target.value),placeholder:"请输入 11 位手机号"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"微信号"}),(0,n.jsx)("input",{value:b,onChange:e=>y(e.target.value),placeholder:"用于成交后展示给买家"})]}),"sms"===m&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"短信验证码"}),(0,n.jsxs)("div",{className:"input-row",children:[(0,n.jsx)("input",{value:g,onChange:e=>N(e.target.value),placeholder:"6 位验证码"}),(0,n.jsx)("button",{className:"secondary-btn",type:"button",onClick:E,disabled:w||S>0,children:S>0?"".concat(S,"s"):"发送验证码"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{children:"密码"}),(0,n.jsx)("input",{type:"password",value:f,onChange:e=>v(e.target.value),placeholder:"至少 6 位"}),(0,n.jsx)("p",{className:"form-note",children:"默认采用密码登录；短信模式可同步重置密码。"})]}),(0,n.jsx)("button",{className:"primary-btn",onClick:O,disabled:_,children:_?"正在处理...":"sms"===m?"短信校验后进入":"立即进入"}),a&&(0,n.jsx)("p",{className:"form-note",children:"已经在其他标签登录，可直接切换页面使用。"})]})]})]})}),(0,n.jsx)(d.F,{message:h})]})}}},function(e){e.O(0,[424,888,774,179],function(){return e(e.s=163)}),_N_E=e.O()}]);
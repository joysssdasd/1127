(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{577:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return a(4298)}])},2021:function(e,s,a){"use strict";a.d(s,{Z:function(){return d}});var n=a(5893),i=a(1664),t=a.n(i),l=a(1163),r=a(4611);let c=[{href:"/",label:"首页"},{href:"/publish",label:"发布"},{href:"/search",label:"智能搜索"},{href:"/recharge",label:"积分充值"},{href:"/me",label:"个人中心"}];function d(e){var s,a,i;let{children:d}=e,o=(0,l.useRouter)(),{user:h,logout:u}=(0,r.a)(),m=e=>"/"===e?"/"===o.pathname:o.pathname===e||o.pathname.startsWith("".concat(e,"/"));return(0,n.jsxs)("div",{style:{padding:"0 20px"},children:[(0,n.jsxs)("header",{className:"app-header",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"app-brand",children:"C2C 情报局"}),(0,n.jsx)("div",{style:{fontSize:12,color:"var(--muted)"},children:"72 小时自动下架 \xb7 智能风控撮合 \xb7 Supabase 实时底座"})]}),(0,n.jsx)("nav",{className:"app-nav",children:c.map(e=>(0,n.jsx)(t(),{href:e.href,className:m(e.href)?"active":void 0,children:e.label},e.href))}),(0,n.jsx)("div",{className:"user-chip",children:h?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontWeight:600},children:null!==(s=h.phone)&&void 0!==s?s:"未绑定手机"}),(0,n.jsxs)("div",{style:{fontSize:12,color:"var(--muted)"},children:["微信：",null!==(a=h.wechat)&&void 0!==a?a:"未设置"," \xb7 积分 ",null!==(i=h.points)&&void 0!==i?i:0]})]}),(0,n.jsx)("button",{className:"secondary-btn",onClick:u,children:"退出"})]}):(0,n.jsx)(t(),{className:"primary-btn",href:"/auth/login",children:"登录 / 入驻"})})]}),(0,n.jsx)("main",{style:{maxWidth:1200,margin:"0 auto 60px",padding:"0 8px"},children:d})]})}},971:function(e,s,a){"use strict";a.d(s,{F:function(){return i}});var n=a(5893);function i(e){let{message:s}=e;return s?(0,n.jsx)("div",{className:"toast",children:s}):null}},7996:function(e,s,a){"use strict";a.d(s,{p:function(){return i}});var n=a(7294);function i(){let[e,s]=(0,n.useState)(null);return{message:e,show:(0,n.useCallback)(e=>{s(e),window.setTimeout(()=>s(null),2500)},[])}}},4298:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return o}});var n=a(5893),i=a(7294),t=a(1163),l=a(2021),r=a(7996),c=a(971),d=a(4611);function o(){let e=(0,t.useRouter)(),{tokens:s,isAdmin:a,loading:o}=(0,d.a)(),{message:h,show:u}=(0,r.p)(),[m,p]=(0,i.useState)([]),[j,x]=(0,i.useState)([]),f=s?{Authorization:"Bearer ".concat(s.accessToken)}:void 0,v=async()=>{if(f)try{var e,s;let[a,n]=await Promise.all([fetch("/api/admin/recharge",{headers:f}),fetch("/api/admin/deals",{headers:f})]);if(!a.ok||!n.ok){u("数据加载失败");return}let i=await a.json(),t=await n.json();p(null!==(e=i.data)&&void 0!==e?e:[]),x(null!==(s=t.data)&&void 0!==s?s:[])}catch(e){u(e.message)}};(0,i.useEffect)(()=>{o||(s&&a?v():(u("仅管理员可访问"),e.replace("/")))},[o,s,a]);let N=async(e,s)=>{if(f){if(!(await fetch("/api/admin/recharge",{method:"POST",headers:{"Content-Type":"application/json",...f},body:JSON.stringify({id:e,action:s})})).ok){u("处理失败");return}u("approve"===s?"已通过":"已拒绝"),v()}},g=async()=>{if(!f)return;let e=await fetch("/api/admin/deals",{method:"POST",headers:{"Content-Type":"application/json",...f},body:JSON.stringify({action:"remind"})});if(!e.ok){u("提醒失败");return}let s=await e.json();u("已提醒 ".concat(s.reminded," 位买家"))},b=(0,i.useMemo)(()=>[{title:"待审核充值",value:m.length},{title:"待确认成交",value:j.length}],[m.length,j.length]);return s&&(a||o)?(0,n.jsxs)(l.Z,{children:[(0,n.jsxs)("div",{className:"page-section",children:[(0,n.jsx)("div",{className:"section-heading",children:"管理员面板"}),(0,n.jsx)("p",{className:"section-subtitle",children:"管理员必须使用短信模式登录，此处无公开入口。"}),(0,n.jsx)("div",{className:"grid-two",children:b.map(e=>(0,n.jsxs)("div",{className:"feature-card",children:[(0,n.jsx)("h3",{style:{marginTop:0},children:e.title}),(0,n.jsx)("p",{style:{fontSize:32,margin:0},children:e.value})]},e.title))}),(0,n.jsxs)("div",{className:"cta-stack",children:[(0,n.jsx)("button",{className:"secondary-btn",onClick:v,children:"刷新数据"}),(0,n.jsx)("button",{className:"primary-btn",onClick:g,children:"一键提醒成交"})]})]}),(0,n.jsxs)("div",{className:"page-section",children:[(0,n.jsx)("div",{className:"section-heading",children:"充值审核"}),0===m.length&&(0,n.jsx)("p",{style:{color:"var(--muted)"},children:"暂无充值待审核。"}),(0,n.jsx)("div",{className:"listing-grid",children:m.map(e=>(0,n.jsxs)("div",{className:"list-card",children:[(0,n.jsxs)("h3",{children:["用户 ",e.userId]}),(0,n.jsxs)("p",{style:{color:"var(--muted)"},children:["金额：",e.amount]}),(0,n.jsx)("a",{href:e.voucherUrl,target:"_blank",rel:"noreferrer",style:{fontSize:13,color:"#0a84ff"},children:"查看凭证"}),(0,n.jsxs)("div",{className:"list-card-actions",children:[(0,n.jsx)("button",{className:"primary-btn",onClick:()=>N(e.id,"approve"),children:"通过"}),(0,n.jsx)("button",{className:"secondary-btn",onClick:()=>N(e.id,"reject"),children:"拒绝"})]})]},e.id))})]}),(0,n.jsxs)("div",{className:"page-section",children:[(0,n.jsx)("div",{className:"section-heading",children:"待确认成交"}),0===j.length&&(0,n.jsx)("p",{style:{color:"var(--muted)"},children:"暂无待处理记录。"}),(0,n.jsx)("div",{className:"timeline",children:j.map(e=>(0,n.jsxs)("div",{className:"timeline-item",children:[(0,n.jsx)("div",{className:"timeline-dot"}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("strong",{children:["信息 ",e.postId]}),(0,n.jsxs)("p",{className:"form-note",children:["买家 ",e.buyerId," \xb7 截止 ",new Date(e.confirmDeadline).toLocaleString()]})]})]},e.id))})]}),(0,n.jsx)(c.F,{message:h})]}):(0,n.jsxs)(l.Z,{children:[(0,n.jsx)("div",{className:"page-section",children:(0,n.jsx)("p",{children:"正在校验权限..."})}),(0,n.jsx)(c.F,{message:h})]})}}},function(e){e.O(0,[424,888,774,179],function(){return e(e.s=577)}),_N_E=e.O()}]);
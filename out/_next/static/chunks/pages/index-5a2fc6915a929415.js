(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(5416)}])},2021:function(e,s,n){"use strict";n.d(s,{Z:function(){return d}});var t=n(5893),a=n(1664),i=n.n(a),l=n(1163),r=n(4611);let c=[{href:"/",label:"首页"},{href:"/publish",label:"发布"},{href:"/search",label:"智能搜索"},{href:"/recharge",label:"积分充值"},{href:"/me",label:"个人中心"}];function d(e){var s,n,a;let{children:d}=e,o=(0,l.useRouter)(),{user:u,logout:h}=(0,r.a)(),m=e=>"/"===e?"/"===o.pathname:o.pathname===e||o.pathname.startsWith("".concat(e,"/"));return(0,t.jsxs)("div",{style:{padding:"0 20px"},children:[(0,t.jsxs)("header",{className:"app-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"app-brand",children:"C2C 情报局"}),(0,t.jsx)("div",{style:{fontSize:12,color:"var(--muted)"},children:"72 小时自动下架 \xb7 智能风控撮合 \xb7 Supabase 实时底座"})]}),(0,t.jsx)("nav",{className:"app-nav",children:c.map(e=>(0,t.jsx)(i(),{href:e.href,className:m(e.href)?"active":void 0,children:e.label},e.href))}),(0,t.jsx)("div",{className:"user-chip",children:u?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontWeight:600},children:null!==(s=u.phone)&&void 0!==s?s:"未绑定手机"}),(0,t.jsxs)("div",{style:{fontSize:12,color:"var(--muted)"},children:["微信：",null!==(n=u.wechat)&&void 0!==n?n:"未设置"," \xb7 积分 ",null!==(a=u.points)&&void 0!==a?a:0]})]}),(0,t.jsx)("button",{className:"secondary-btn",onClick:h,children:"退出"})]}):(0,t.jsx)(i(),{className:"primary-btn",href:"/auth/login",children:"登录 / 入驻"})})]}),(0,t.jsx)("main",{style:{maxWidth:1200,margin:"0 auto 60px",padding:"0 8px"},children:d})]})}},971:function(e,s,n){"use strict";n.d(s,{F:function(){return a}});var t=n(5893);function a(e){let{message:s}=e;return s?(0,t.jsx)("div",{className:"toast",children:s}):null}},7996:function(e,s,n){"use strict";n.d(s,{p:function(){return a}});var t=n(7294);function a(){let[e,s]=(0,t.useState)(null);return{message:e,show:(0,t.useCallback)(e=>{s(e),window.setTimeout(()=>s(null),2500)},[])}}},5416:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return h}});var t=n(5893),a=n(7294),i=n(1664),l=n.n(i),r=n(2021),c=n(4611),d=n(7996),o=n(971);let u=[{title:"72 小时自动下架",description:"超时信息自动回收，保持信息池纯净，避免买家踩坑。"},{title:"AI 语义打标",description:"发布时自动生成标签与补充描述，方便搜索与风控审核。"},{title:"积分可追溯",description:"每一次充值、扣减、成交都在积分账本中留痕，可随时导出。"}];function h(){let{tokens:e,user:s}=(0,c.a)(),{message:n,show:i}=(0,d.p)(),[h,m]=(0,a.useState)([]),[p,v]=(0,a.useState)(!1),[x,j]=(0,a.useState)(""),[f,g]=(0,a.useState)(!1),[N,y]=(0,a.useState)([]),w=(0,a.useCallback)(async e=>{var s,n;v(!0);try{let n=e?"?keyword=".concat(encodeURIComponent(e)):"",t=await fetch("/api/listings".concat(n));if(!t.ok){if(503===t.status){i("数据库服务暂时不可用，显示演示数据"),m([]);return}throw Error("HTTP ".concat(t.status))}let a=await t.json();m(null!==(s=a.data)&&void 0!==s?s:[])}catch(e){console.warn("Failed to load listings:",e),(null===(n=e.message)||void 0===n?void 0:n.includes("503"))&&i("数据库服务暂时不可用，显示演示数据"),m([])}finally{v(!1)}},[i]);(0,a.useEffect)(()=>{w()},[w]),(0,a.useEffect)(()=>{fetch("/api/announcements").then(e=>{if(503===e.status)return console.warn("Announcements service unavailable"),{data:[]};if(!e.ok)throw Error("HTTP ".concat(e.status));return e.json()}).then(e=>{var s;return y(null!==(s=e.data)&&void 0!==s?s:[])}).catch(()=>{})},[]);let b=function(e,s){let[n,t]=(0,a.useState)(0),[i,l]=(0,a.useState)(!1),[r,c]=(0,a.useState)(!1),d=(0,a.useRef)(null),o=(0,a.useRef)(0),u=(0,a.useRef)(e);(0,a.useEffect)(()=>{u.current=e},[e]);let h=(0,a.useCallback)(async()=>{c(!0);try{await u.current()}finally{c(!1)}},[]);return(0,a.useEffect)(()=>{let e=e=>{if(window.scrollY<=4&&!r){var s,n;d.current=null!==(n=null===(s=e.touches[0])||void 0===s?void 0:s.clientY)&&void 0!==n?n:null}else d.current=null},s=e=>{var s,n;if(null===d.current)return;let a=(null!==(n=null===(s=e.touches[0])||void 0===s?void 0:s.clientY)&&void 0!==n?n:0)-d.current;if(a>0){l(!0);let e=Math.min(a,180);o.current=e,t(e)}else l(!1),o.current=0,t(0)},n=()=>{o.current>=90&&!r&&h(),o.current=0,d.current=null,l(!1),t(0)};return window.addEventListener("touchstart",e,{passive:!0}),window.addEventListener("touchmove",s,{passive:!0}),window.addEventListener("touchend",n),()=>{window.removeEventListener("touchstart",e),window.removeEventListener("touchmove",s),window.removeEventListener("touchend",n)}},[r,90,h]),{pulling:i,distance:n,refreshing:r}}((0,a.useCallback)(async()=>{await w(x.trim()||void 0)},[x,w])),E=async()=>{if(!x.trim()){w();return}g(!0);try{await w(x.trim())}finally{g(!1)}},S=async s=>{if(!e){i("请先登录后再解锁微信联系方式");return}try{let t=await fetch("/api/contact",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.accessToken)},body:JSON.stringify({postId:s})}),a=await t.json();if(!t.ok){var n;throw Error(null!==(n=a.error)&&void 0!==n?n:"解锁失败")}i("已解锁微信：".concat(a.data.contact))}catch(e){i(e.message)}},k=(0,a.useMemo)(()=>{let e=h.reduce((e,s)=>{var n;return e+(null!==(n=s.totalDeals)&&void 0!==n?n:0)},0),s=h.reduce((e,s)=>{var n;return e+(null!==(n=s.remainingViews)&&void 0!==n?n:0)},0);return[{label:"在架信息",value:h.length},{label:"累计成交",value:e},{label:"剩余可查看次数",value:s}]},[h]),T=["管理后台自动跳转：".concat((null==s?void 0:s.phone)?"已绑定":"待完善"),"管理员仅限短信通道","SPUG targets 动态推送"];return(0,t.jsxs)(r.Z,{children:[(b.pulling||b.refreshing)&&(0,t.jsx)("div",{className:"pull-indicator",children:b.refreshing?"正在同步最新撮合数据...":"下拉刷新 ".concat(Math.min(100,Math.round(b.distance/90*100)),"%")}),(0,t.jsxs)("div",{className:"page-section hero",children:[(0,t.jsxs)("div",{className:"hero-content",children:[(0,t.jsx)("div",{className:"chip emphasis",children:"Apple 风格 \xb7 移动优先"}),(0,t.jsx)("h1",{style:{marginTop:16,marginBottom:12},children:"即时 C2C 情报中枢"}),(0,t.jsx)("p",{style:{fontSize:17},children:"72 小时自动下架、AI 风控打标、积分全链路可追溯，让买卖双方以微信联系为核心进行快速撮合。"}),(0,t.jsxs)("div",{className:"cta-stack",children:[(0,t.jsx)(l(),{className:"primary-btn",href:e?"/publish":"/auth/login",children:e?"立即发布":"登录并发布"}),(0,t.jsx)(l(),{className:"secondary-btn",href:"/search",children:"智能搜索"})]}),(0,t.jsx)("div",{style:{marginTop:18,display:"flex",flexWrap:"wrap",gap:8},children:T.map(e=>(0,t.jsx)("span",{className:"pill",children:e},e))})]}),(0,t.jsx)("div",{className:"stat-grid",children:k.map(e=>(0,t.jsxs)("div",{className:"stat-card",children:[(0,t.jsx)("strong",{children:e.value}),(0,t.jsx)("span",{children:e.label})]},e.label))})]}),(0,t.jsxs)("div",{className:"page-section",children:[(0,t.jsx)("div",{className:"section-heading",children:"实时信息"}),(0,t.jsx)("p",{className:"section-subtitle",children:"支持关键词检索，历史搜索会沉淀在个人中心，便于快速回看。"}),(0,t.jsxs)("div",{className:"input-row",style:{marginBottom:20},children:[(0,t.jsx)("input",{value:x,onChange:e=>j(e.target.value),placeholder:"请输入关键词 / 行业 / 城市",style:{flex:1}}),(0,t.jsx)("button",{className:"primary-btn",onClick:E,disabled:f,children:f?"检索中...":"搜索"})]}),(0,t.jsx)("div",{className:"listing-grid",children:h.map(s=>{var n;return(0,t.jsxs)("div",{className:"list-card",children:[(0,t.jsxs)("div",{className:"meta-row",children:[(0,t.jsx)("span",{className:"chip",children:"sell"===s.tradeType?"出售":"buy"===s.tradeType?"求购":"其他"}),(0,t.jsxs)("span",{className:"chip emphasis",children:["剩余 ",s.remainingViews,"/",s.viewLimit," 次"]})]}),(0,t.jsx)("h3",{children:s.title}),(0,t.jsx)("p",{style:{margin:"8px 0",color:"var(--muted)"},children:s.description}),(0,t.jsxs)("div",{className:"meta-row",children:[(0,t.jsxs)("span",{className:"badge",children:[(0,t.jsx)("strong",{children:"价格"})," \xa5",s.price]}),(0,t.jsxs)("span",{className:"badge",children:["成交 ",null!==(n=s.totalDeals)&&void 0!==n?n:0," 次"]}),(0,t.jsx)("span",{className:"badge",children:"active"===s.status?"在售":"已下架"})]}),(0,t.jsxs)("div",{className:"list-card-actions",children:[(0,t.jsx)(l(),{className:"secondary-btn",href:"/listings/".concat(s.id),children:"查看详情"}),(0,t.jsx)("button",{className:"primary-btn",disabled:!e||"active"!==s.status,onClick:()=>S(s.id),children:"解锁微信"})]})]},s.id)})}),p&&(0,t.jsx)("p",{style:{textAlign:"center",marginTop:16},children:"正在同步数据..."}),!p&&0===h.length&&(0,t.jsx)("p",{style:{textAlign:"center",color:"var(--muted)",marginTop:16},children:"暂无匹配数据，尝试换个关键词或直接发布。"})]}),(0,t.jsxs)("div",{className:"page-section",children:[(0,t.jsx)("div",{className:"section-heading",children:"平台亮点"}),(0,t.jsx)("div",{className:"grid-three",children:u.map(e=>(0,t.jsxs)("div",{className:"feature-card",children:[(0,t.jsx)("h3",{style:{marginTop:0},children:e.title}),(0,t.jsx)("p",{style:{color:"var(--muted)",lineHeight:1.6},children:e.description})]},e.title))})]}),(0,t.jsxs)("div",{className:"page-section",children:[(0,t.jsx)("div",{className:"section-heading",children:"系统公告"}),(0,t.jsx)("p",{className:"section-subtitle",children:"运营、风控、短信通道等重要更新会在此推送，管理员也可在后台查看完整日志。"}),(0,t.jsxs)("div",{className:"grid-three",children:[N.map(e=>(0,t.jsxs)("div",{className:"announcement-card",children:[(0,t.jsx)("div",{className:"announcement-tag",children:e.tag}),(0,t.jsx)("h3",{style:{margin:"6px 0"},children:e.title}),(0,t.jsx)("p",{style:{color:"var(--muted)",lineHeight:1.6},children:e.description}),(0,t.jsx)("span",{style:{fontSize:12,color:"var(--muted)"},children:new Date(e.publishedAt).toLocaleString()})]},e.id)),0===N.length&&(0,t.jsx)("p",{style:{color:"var(--muted)"},children:"暂无公告，敬请期待下一次更新。"})]})]}),(0,t.jsx)(o.F,{message:n})]})}}},function(e){e.O(0,[424,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);